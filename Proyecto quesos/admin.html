<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin — Queso & Sabor</title>
<style>
  :root{--bg:#f6f7f9;--card:#fff;--text:#1f2937;--muted:#6b7280;--line:#e5e7eb;--r:10px}
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
  .wrap{width:min(960px,94vw);margin:18px auto}
  header,section{background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:12px}
  header{display:flex;justify-content:space-between;align-items:center}
  .brand{font-weight:700} .muted{color:var(--muted)} .row{display:flex;gap:8px;flex-wrap:wrap}
  .btn,a.btn{border:1px solid var(--line);background:#fff;border-radius:8px;padding:8px 12px;cursor:pointer;text-decoration:none;color:inherit}
  .btn:hover,a.btn:hover{background:#f9fafb}
  h2{margin:0 0 8px;font-size:18px}
  label{font-size:13px;color:var(--muted)} input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:8px;background:#fff}
  .grid{display:grid;gap:8px} .g-4{grid-template-columns:2fr 1fr 1fr 1fr} .g-2{grid-template-columns:1fr 1fr}
  .list{display:grid;gap:8px;margin-top:8px}
  .item{border:1px solid var(--line);border-radius:8px;padding:10px;display:grid;gap:8px}
  .head{display:flex;align-items:center;gap:10px}
  .thumb{width:56px;height:56px;border-radius:8px;object-fit:cover;background:#f3f4f6}
  .title{font-weight:600} .small{font-size:12px;color:var(--muted)}
  .ok{color:#065f46} .err{color:#7f1d1d}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <nav class="row">
      <a class="btn" href="index.html">← Tienda</a>
      <a class="btn" href="carrito.html">Carrito</a>
      <a class="btn" href="mispedidos.html">Mis pedidos</a>
    </nav>
    <div class="brand">Queso &amp; Sabor — Admin</div>
    <div></div>
  </header>

  <!-- US-13: Crear producto -->
  <section>
    <h2>Crear producto</h2>
    <div class="grid g-4">
      <div><label>Nombre*</label><input id="c-nombre" placeholder="Ej. Gouda clásico"></div>
      <div><label>Precio (CLP)*</label><input id="c-precio" type="number" min="0" step="1" placeholder="5990"></div>
      <div><label>Stock*</label><input id="c-stock" type="number" min="0" step="1" placeholder="8"></div>
      <div><label>Tipo de leche*</label>
        <select id="c-leche">
          <option value="">—</option><option value="vaca">Vaca</option><option value="cabra">Cabra</option><option value="oveja">Oveja</option>
        </select>
      </div>
    </div>
    <div class="grid g-2" style="margin-top:8px">
      <div><label>Descripción</label><textarea id="c-desc" placeholder="Opcional"></textarea></div>
      <div><label>Imagen (URL)</label><input id="c-img" placeholder="https://… (opcional)"></div>
    </div>
    <div class="row" style="margin-top:8px">
      <button id="btn-create" class="btn">Guardar</button>
      <span id="c-msg" class="small"></span>
    </div>
  </section>

  <!-- US-14/15: Editar precio/stock/foto/leche -->
  <section>
    <h2>Productos</h2>
    <div id="list" class="list"></div>
    <p id="empty" class="small muted" hidden>No hay productos.</p>
  </section>
</div>

<script>
/* ===== Storage básico ===== */
const PROD_KEY="qs_products";
const load=()=>{try{return JSON.parse(localStorage.getItem(PROD_KEY))||[]}catch{return[]}};
const save=(list)=>localStorage.setItem(PROD_KEY,JSON.stringify(list));
const uid=()=> "p_"+Math.random().toString(36).slice(2,10);

/* ===== Crear ===== */
const $n=document.getElementById("c-nombre");
const $p=document.getElementById("c-precio");
const $s=document.getElementById("c-stock");
const $l=document.getElementById("c-leche");
const $d=document.getElementById("c-desc");
const $i=document.getElementById("c-img");
const $cmsg=document.getElementById("c-msg");

document.getElementById("btn-create").addEventListener("click",()=>{
  const nombre=$n.value.trim(), precio=Number($p.value), stock=Number($s.value), leche=$l.value;
  if(!nombre || !(precio>=0) || !Number.isInteger(stock)||stock<0 || !leche){
    $cmsg.className="small err"; $cmsg.textContent="Completa nombre, precio, stock y leche."; return;
  }
  const now=Date.now();
  const prod={id:uid(),nombre,precio,stock,leche,descripcion:$d.value.trim(),imagen:$i.value.trim(),createdAt:now,updatedAt:now,activo:true};
  const list=load(); list.push(prod); save(list);
  [$n,$p,$s,$l,$d,$i].forEach(el=>el.value=""); 
  $cmsg.className="small ok"; $cmsg.textContent="Producto creado."; render(); setTimeout(()=>($cmsg.textContent=""),1200);
});

/* ===== Lista + edición simple ===== */
const $list=document.getElementById("list"), $empty=document.getElementById("empty");

function card(p){return `
  <div class="item" data-id="${p.id}">
    <div class="head">
      <img class="thumb" src="${p.imagen||''}" alt="" onerror="this.style.display='none'">
      <div>
        <div class="title">${p.nombre}</div>
        <div class="small">Precio: $${Number(p.precio||0).toLocaleString('es-CL')} · Stock: ${p.stock} · Leche: ${p.leche||'—'}</div>
      </div>
    </div>
    <div class="grid g-4">
      <div><label>Precio</label><input class="e-precio" type="number" min="0" step="1" value="${p.precio}"></div>
      <div><label>Stock</label><input class="e-stock" type="number" min="0" step="1" value="${p.stock}"></div>
      <div><label>Leche</label>
        <select class="e-leche">
          <option value="vaca">Vaca</option><option value="cabra">Cabra</option><option value="oveja">Oveja</option>
        </select>
      </div>
      <div><label>Imagen (URL)</label><input class="e-img" value="${p.imagen||''}" placeholder="https://…"></div>
    </div>
    <div class="row">
      <button class="btn e-save">Guardar</button>
      <span class="small muted">id: ${p.id}</span>
      <span class="small" data-msg></span>
    </div>
  </div>`;}

function wire(cardEl,p){
  const id=p.id;
  const $precio=cardEl.querySelector(".e-precio");
  const $stock =cardEl.querySelector(".e-stock");
  const $leche =cardEl.querySelector(".e-leche");
  const $img   =cardEl.querySelector(".e-img");
  const $msg   =cardEl.querySelector("[data-msg]");
  $leche.value=p.leche||"";

  cardEl.querySelector(".e-save").addEventListener("click",()=>{
    const precio=Number($precio.value), stock=Number($stock.value);
    if(!(precio>=0)){ $msg.className="small err"; $msg.textContent="Precio inválido"; return; }
    if(!Number.isInteger(stock)||stock<0){ $msg.className="small err"; $msg.textContent="Stock inválido"; return; }
    const list=load(); const i=list.findIndex(x=>x.id===id); if(i<0) return;
    list[i].precio=precio; list[i].stock=stock; list[i].leche=$leche.value||list[i].leche; list[i].imagen=$img.value.trim(); list[i].updatedAt=Date.now();
    save(list); $msg.className="small ok"; $msg.textContent="Guardado"; render();
  });
}

function render(){
  const list=load();
  $empty.hidden=list.length>0;
  $list.innerHTML=list.map(card).join("");
  [...$list.children].forEach((el,idx)=>wire(el,list[idx]));
}

render();
</script>
</body>
</html>
