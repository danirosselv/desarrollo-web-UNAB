<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mis pedidos — Queso & Sabor</title>
<style>
  body{margin:0; font-family:system-ui; background:#f6f7f9; line-height:1.45}
  .container{max-width:960px; margin:auto; padding:10px}
  header{background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:10px; margin-bottom:12px; display:flex; justify-content:space-between}
  .btn{border:1px solid #e5e7eb; border-radius:8px; padding:8px 12px; text-decoration:none; color:#1f2937}
  section{background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:16px}
  .empty{border:2px dashed #e5e7eb; border-radius:12px; padding:24px; text-align:center; color:#6b7280}
  ul{padding:0; list-style:none; margin:12px 0 0}
  .order{border:1px solid #e5e7eb; border-radius:10px; padding:12px; margin-bottom:10px}
  .row{display:flex; justify-content:space-between; flex-wrap:wrap}
  .chip{padding:4px 8px; border-radius:999px; border:1px solid #e5e7eb; background:#fafafa; font-size:12px; margin-right:6px}
  .items li{display:flex; justify-content:space-between; border:1px solid #e5e7eb; border-radius:8px; padding:8px; margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <header>
    <nav>
      <a class="btn" href="index.html">← Tienda</a>
      <a class="btn" href="carrito.html">Carrito</a>
    </nav>
    <div>Queso & Sabor</div>
  </header>

  <section>
    <h2>Mis pedidos</h2>
    <div id="empty" class="empty" hidden>No tienes pedidos.</div>
    <ul id="orders"></ul>
  </section>
</div>

<script>
function loadOrders(){ 
  return JSON.parse(localStorage.getItem("qs_orders")||"[]") 
}

function render(){
  const orders = loadOrders()
  const $list = document.getElementById("orders")
  const $empty = document.getElementById("empty")
  
  if(!orders.length){
    $list.innerHTML = ""
    $empty.hidden = false
    return
  }
  
  $empty.hidden = true
  orders.sort((a,b)=> (b.createdAt||0) - (a.createdAt||0))
  
  $list.innerHTML = orders.map(o=>{
    const items = Object.values(o.items||{}).map(it=>
      `<li><span>${it.nombre} x${it.qty}</span><span>$${(it.qty*it.precio).toLocaleString()}</span></li>`
    ).join("")
    
    return `
      <li class="order">
        <div class="row">
          <div>
            <strong>Pedido ${o.id}</strong>
            <div>${o.status?.current||'Nuevo'} • $${o.total?.toLocaleString()||'0'}</div>
          </div>
        </div>
        <details style="margin-top:8px">
          <summary>Detalles</summary>
          <ul class="items">${items}</ul>
        </details>
      </li>`
  }).join("")
}

// Migrar pedido antiguo si existe
const old = JSON.parse(localStorage.getItem("qs_last_order")||"null")
if(old){
  const orders = loadOrders()
  if(!orders.some(o=>o.id===old.id)){
    orders.push(old)
    localStorage.setItem("qs_orders",JSON.stringify(orders))
  }
}

render()
</script>
</body>
</html>